<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>INetMock docs</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="build_install.html"><strong aria-hidden="true">1.</strong> Building &amp; Installation</a></li><li class="expanded "><a href="config.html"><strong aria-hidden="true">2.</strong> Configuration</a></li><li><ol class="section"><li class="expanded "><a href="config/yaml-config.html"><strong aria-hidden="true">2.1.</strong> config.yaml</a></li><li class="expanded "><a href="config/http_mock.html"><strong aria-hidden="true">2.2.</strong> http_mock</a></li><li class="expanded "><a href="config/dns_mock.html"><strong aria-hidden="true">2.3.</strong> dns_mock</a></li><li class="expanded "><a href="config/tls_interceptor.html"><strong aria-hidden="true">2.4.</strong> tls_interceptor</a></li></ol></li><li class="expanded "><a href="deploy.html"><strong aria-hidden="true">3.</strong> Deployment</a></li><li class="expanded "><a href="api.html"><strong aria-hidden="true">4.</strong> API</a></li><li><ol class="section"><li class="expanded "><a href="dev/custom_handler.html"><strong aria-hidden="true">4.1.</strong> Custom handler</a></li><li class="expanded "><a href="dev/plugin_command.html"><strong aria-hidden="true">4.2.</strong> Plugin command</a></li><li class="expanded "><a href="dev/logging.html"><strong aria-hidden="true">4.3.</strong> Logging</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">INetMock docs</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<h2><a class="header" href="#building-from-source" id="building-from-source">Building from source</a></h2>
<h3><a class="header" href="#requirements" id="requirements">Requirements</a></h3>
<ul>
<li>go 1.14</li>
<li>make</li>
<li>gcc</li>
</ul>
<h3><a class="header" href="#binary" id="binary">Binary</a></h3>
<p>To get the binary and all plugins just run</p>
<pre><code class="language-bash">make
</code></pre>
<p>and you'll get a <code>inetmock</code> binary and a <code>plugins</code> directory containing all default plugins.</p>
<p>The default plugins are:</p>
<ul>
<li><code>http_mock</code></li>
<li><code>dns_mock</code></li>
<li><code>tls_interceptor</code></li>
</ul>
<h2><a class="header" href="#dockerpodman" id="dockerpodman">Docker/Podman</a></h2>
<h2><a class="header" href="#getting-a-pre-built-binary-coming-soon" id="getting-a-pre-built-binary-coming-soon">Getting a pre-built binary (coming soon)</a></h2>
<h1><a class="header" href="#configuration" id="configuration">Configuration</a></h1>
<h2><a class="header" href="#plugins--handlers" id="plugins--handlers">Plugins &amp; handlers</a></h2>
<p><em>INetMock</em> is based on plugins that ship one or more <strong>protocol handlers</strong>.
Examples for protocol handlers are HTTP or DNS but also TLS.</p>
<p>The application ships with the following handlers:</p>
<ul>
<li><code>http_mock</code></li>
<li><code>dns_mock</code></li>
<li><code>tls_interceptor</code></li>
</ul>
<p>The configuration of an so called endpoint always specifies which handler should be used, which IP address and port it should listen on and some handler specific <code>options</code>.
This way the whole system is very flexible and can be configured for various individual scenarios.</p>
<h2><a class="header" href="#commands" id="commands">Commands</a></h2>
<p>Beside of <strong>protocol handlers</strong> a plugin can also ship custom commands e.g. the <code>tls_interceptor</code> ships a <code>generate-ca</code> command to bootstrap a certificate authority key-pair that can be reused for multiple instances.</p>
<h1><a class="header" href="#configyaml" id="configyaml"><code>config.yaml</code></a></h1>
<h2><a class="header" href="#intro" id="intro">Intro</a></h2>
<p>The configuration of <em>INetMock</em> is mostly done in the <code>config.yaml</code>.
It defines which endpoints should be started with which handler and a few more things.</p>
<p>Every endpoint has a name that is used for logging and as already mentioned consists of listening IP and port, the handler and its options.</p>
<p>INetMock comes with <em>&quot;Batteries included&quot;</em> and ships with a basic <code>config.yaml</code> that defines a basic set of endpoints for:</p>
<ul>
<li>HTTP</li>
<li>HTTPS</li>
<li>DNS</li>
<li>DNS-over-TLS</li>
</ul>
<h2><a class="header" href="#sample" id="sample">Sample</a></h2>
<pre><code class="language-yml">endpoints:
    myHttpEndpoint:
        handler: http_mock
        listenAddress: 127.0.0.1
        port: 8080
        options:
            rules:
                - pattern: &quot;.*&quot;
                  target: ./assets/fakeFiles/default.html
</code></pre>
<h1><a class="header" href="#http_mock" id="http_mock"><code>http_mock</code></a></h1>
<h2><a class="header" href="#intro-1" id="intro-1">Intro</a></h2>
<p>The <code>http_mock</code> handler expects an array of rules how it should respond to different request paths.
This allows to e.g. return an image if the request path contains something like <em>&quot;asdf.jpg&quot;</em> but with binary if the request path contains something like <em>&quot;malicous.exe&quot;</em>.</p>
<p>A <em>&quot;catch all&quot;</em> rule could return in any case an HTML page or if nothing is provided the handler returns an HTTP 404 status code.</p>
<p>The rules are taken into account in the same order than they are defined in the <code>config.yaml</code>.</p>
<p>Every rule consists of a regex <code>pattern</code> (<strong>re2</strong> compatible) and a <code>response</code> path to the file it should return.</p>
<p>In the future more advanced rules might be possible e.g. to match not on the request path but on some header values.</p>
<h2><a class="header" href="#configuration-1" id="configuration-1">Configuration</a></h2>
<h3><a class="header" href="#matching-a-specific-path" id="matching-a-specific-path">Matching a specific path</a></h3>
<p>The easiest possible pattern is to match a static request path:</p>
<pre><code class="language-yml">endpoints:
  plainHttp:
    handler: http_mock
    listenAddress: 0.0.0.0
    port: 80
    options:
      rules:
        - pattern: &quot;/static/http/path/sample.exe&quot;
          response: ./assets/fakeFiles/sample.exe
</code></pre>
<h3><a class="header" href="#matching-a-file-extensions" id="matching-a-file-extensions">Matching a file extensions</a></h3>
<p>While matching a static path might be nice as an example it's not very useful.
Returning a given file for all kinds of of request paths based on the requested file extension is way more handy:</p>
<pre><code class="language-yml">endpoints:
  plainHttp:
    handler: http_mock
    listenAddress: 0.0.0.0
    port: 80
    options:
      rules:
        - pattern: &quot;.*\\.png&quot;
          response: ./assets/fakeFiles/default.png
</code></pre>
<p>So this is already way more flexible but we can do even better:</p>
<pre><code class="language-yml">endpoints:
  plainHttp:
    handler: http_mock
    listenAddress: 0.0.0.0
    port: 80
    options:
      rules:
        - pattern: &quot;.*\\.(?i)(jpg|jpeg)&quot;
          response: ./assets/fakeFiles/default.jpg
</code></pre>
<p>This way the extension ignores any case and matches both <code>.jpg</code> and <code>.jpeg</code> (and of course also e.g. <code>.JpEg</code> and so on and so forth).</p>
<p>The default <code>config.yaml</code> already ships with some basic rules to handle the most common file extensions.</p>
<h3><a class="header" href="#defining-a-fallback" id="defining-a-fallback">Defining a fallback</a></h3>
<p>Last but not least a default case might be necessary to get at least any response but a 404.</p>
<p>This can be achieved with a <code>.*</code> pattern that literally matches everything:</p>
<pre><code class="language-yml">endpoints:
  plainHttp:
    handler: http_mock
    listenAddress: 0.0.0.0
    port: 80
    options:
      rules:
        - pattern: &quot;.*&quot;
          response: ./assets/fakeFiles/default.html
</code></pre>
<h1><a class="header" href="#dns_mock" id="dns_mock"><code>dns_mock</code></a></h1>
<h2><a class="header" href="#intro-2" id="intro-2">Intro</a></h2>
<p>The <code>dns_mock</code> handler expects an array of rules how it should respond to dfferent DNS queries and a fallback strategy.
Currently only queries for <strong>A</strong> records are supported.
The rules are primarily meant to define some exceptions or well known DNS responses e.g. to return to right Google DNS IP but for everything else it will return dummy IPs.</p>
<p>The rules for the <code>dns_mock</code> handler are equivalent to the <code>http_mock</code> rules.
Every rule consists of a <code>pattern</code> that specifies a query name e.g. a single host, a wildcard domain, a wildcard top-level domain or even a <em>&quot;match all&quot;</em> rule is possible.
These rules are evaluated in the same order they are defined in the <code>config.yaml</code>.</p>
<p>The fallback strategy is taken into account whenever a query does not match a rule.</p>
<p>Right now the following fallback strategies are available:</p>
<ul>
<li><em>random</em></li>
<li><em>incremental</em></li>
</ul>
<p>Just like the handler is configured via the <code>options</code> object the fallback strategies are configured via an <code>args</code> object.</p>
<h3><a class="header" href="#random-fallback" id="random-fallback"><em>random</em> fallback</a></h3>
<p>The <em>random</em> fallback strategy is the easier one of the both.
It doesn't take any argument and it just shuffles a random IP address for every request no matter if it was already asked for this IP or not.</p>
<h3><a class="header" href="#incremental-fallback" id="incremental-fallback"><em>incremental</em> fallback</a></h3>
<p>The <em>incremental</em> fallback is little bit more intelligent.
It takes a <code>startIP</code> as an argument which defines from which IP address the strategy starts counting up to respond to DNS queries.
Just like the <em>incremental</em> strategy it is <em>stateless</em> and does not store any already given response for later reuse (at least for now).</p>
<h2><a class="header" href="#configuration-2" id="configuration-2">Configuration</a></h2>
<h3><a class="header" href="#matching-an-explicit-host" id="matching-an-explicit-host">Matching an explicit host</a></h3>
<p>The easiest possible pattern is to match a single host:</p>
<pre><code class="language-yml">endpoints:
  plainDns:
    handler: dns_mock
    listenAddress: 0.0.0.0
    port: 53
    options:
      rules:
        - pattern: &quot;github\\.com&quot;
          response: 1.1.1.1
</code></pre>
<h3><a class="header" href="#matching-a-whole-domain" id="matching-a-whole-domain">Matching a whole domain</a></h3>
<p>While matching a single host is nice2have it's not very helpful in most cases - except for some edge cases where it might be necesary to specifically return a certain IP address.
But it's also possible to match a whole domain no matter what subdomain or sub-subdomain or whatever is requested like this:</p>
<pre><code class="language-yml">endpoints:
  plainDns:
    handler: dns_mock
    listenAddress: 0.0.0.0
    port: 53
    options:
      rules:
        - pattern: &quot;.*\\.google\\.com&quot;
          response: 2.2.2.2
</code></pre>
<h3><a class="header" href="#matching-a-whole-tld" id="matching-a-whole-tld">Matching a whole TLD</a></h3>
<p>In some cases it might also be interesting to distinguish between different requested TLDs.
Therefore it might be interesting to define one IP address to resolve to for every TLD that should be distinguishable.</p>
<pre><code class="language-yml">endpoints:
  plainDns:
    handler: dns_mock
    listenAddress: 0.0.0.0
    port: 53
    options:
      rules:
        - pattern: &quot;.*\\.com&quot;
          response: 2.2.2.2
</code></pre>
<h3><a class="header" href="#matching-any-query" id="matching-any-query">Matching any query</a></h3>
<p>Last but not least it is obvously also possible to match any query.
This is comparable to a <em>&quot;static&quot;</em> fallback strategy in cases where different IP addresses are not necessary but the network setup should be as easy as possible.</p>
<pre><code class="language-yml">endpoints:
  plainDns:
    handler: dns_mock
    listenAddress: 0.0.0.0
    port: 53
    options:
      rules:
        - pattern: &quot;.*&quot;
          response: 10.0.10.1
</code></pre>
<h3><a class="header" href="#fallback-strategies" id="fallback-strategies">Fallback strategies</a></h3>
<h4><a class="header" href="#random" id="random"><em>random</em></a></h4>
<p>Like previously mentioned the <em>random</em> strategy is easy as it can be.
It just takes a random unsigned integer of 32 bits, converts it to an IP address and returns this address as response.
Therefore no further configuration is necessary for now.</p>
<pre><code class="language-yml">endpoints:
  plainDns:
    handler: dns_mock
    listenAddress: 0.0.0.0
    port: 53
    options:
      rules: []
      fallback:
        strategy: random
</code></pre>
<h4><a class="header" href="#incremental" id="incremental"><em>incremental</em></a></h4>
<p>Also like previously mentioned the <em>incremental</em> fallback strategy is fairly easy to setup.
It just takes a <code>startIP</code> as argument which is used to count upwards.
It does <strong>not</strong> check for an interval or something like this right now so a overflow might occur.</p>
<pre><code class="language-yml">endpoints:
  plainDns:
    handler: dns_mock
    listenAddress: 0.0.0.0
    port: 53
    options:
      rules: []
      fallback:
        strategy: incremental
        args:
          startIP: 10.0.0.0
</code></pre>
<h1><a class="header" href="#tls_interceptor" id="tls_interceptor"><code>tls_interceptor</code></a></h1>
<h1><a class="header" href="#deployment" id="deployment">Deployment</a></h1>
<h1><a class="header" href="#api" id="api">API</a></h1>
<h1><a class="header" href="#custom-handler" id="custom-handler">Custom handler</a></h1>
<h1><a class="header" href="#plugin-command" id="plugin-command">Plugin command</a></h1>
<h1><a class="header" href="#logging" id="logging">Logging</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
